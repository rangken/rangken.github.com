<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Express</title>
    <!-- SEO -->
    <meta name="description" content="">
    <meta name="keywords" content=", "/>
    <meta name="author" content="Young.k">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://rangken.github.io/blog/2014/express/">

    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/ko_KR/sdk.js#xfbml=1&appId=873345849376888&version=v2.0";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>

    <!-- Google analytics -->
    <script>
  		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  		ga('create', 'UA-58142397-1', 'auto');
  		ga('send', 'pageview');
    </script>
    <script data-ad-client="ca-pub-9512351571435208" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>


  <body>

    <header class="site-header">
  <div class="wrapper">
    <img style="float: left" src="/img/jaeyoung.png" />
    <a class="site-title" href="/">
      <div style="float: left; margin-left: 30px;">YOUNG.K<div>
    </a>
    <div style="float: left; width:500px;">
      <a style="float: left;" class="post-link" href="http://rangken.gitbooks.io/nextersstudy1/content/">
        <h4 style="color:#ffffff;"> Study </h4>
      </a>
      <a style="float: left; margin-left: 10px;" class="post-link" href="http://nexters.github.io/Node-Study/">
        <h4 style="color:#ffffff;"> Node.js </h4>
      </a>
      <a style="float: left; margin-left: 10px;" class="post-link" href="http://rangken.gitbooks.io/javastudy/content/index.html">
        <h4 style="color:#ffffff;"> Effective-Java </h4>
      </a>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Express</h1>
    <p class="post-meta">Apr 14, 2014
      
	 </p>
  </header>

  <article class="post-content">
    <h3 id="소개">소개</h3>
<p>Node.js 관련 공부 내용을 Gitbook을 사용해 정리하고 있다.
<a href="http://nexters.github.io/Node-Study/3week/express.html">Node.js Gitbook - http://nexters.github.io/Node-Study/3week/express.html</a>
아래 내용은 Gitbook 에 정리한 내용중 Express 내용만 가져온것이다.</p>

<p>http 모듈만으로는 많은 기능을 가진 API 나 웹페이지를 만들기에는 부족하다. 파라메터를 파싱한다거나 쿠키나 세션을 사용한다거나 HTML 랜더링 엔진을 사용한다거나 하려면
좀더 많은 기능이 필요하다. 이런 기능들을 가지고 있는 Node.js 용 웹 프레임 워크가 Express 이다.</p>

<h3 id="설치">설치</h3>
<p><code class="language-plaintext highlighter-rouge">npm install -g express</code></p>

<h3 id="express-init">Express Init</h3>
<p><code class="language-plaintext highlighter-rouge">express myproject</code>
Express 용 Project 생성!</p>

<p><code class="language-plaintext highlighter-rouge">npm install</code>
해당 프로젝트에 종속 라이브러리들을 설치!</p>

<p><code class="language-plaintext highlighter-rouge">node app.js</code>
Express 서버 실행</p>

<h3 id="appjs">app.js</h3>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="code"><pre><span class="cm">/**
 * Module dependencies.
 */</span>

<span class="c1">// 사용할 라이브러리들을 포함 시킨다.</span>
<span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// 우리가 사용할 express 엔진</span>
<span class="kd">var</span> <span class="nx">routes</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./routes</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// express 에서 기본 생성해주는 라우팅 해당 파일을 통해 여러 url 들을 라우팅한다.</span>
<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./routes/user</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// User 관련 라우팅</span>
<span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// node 기본 모듈인 http</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// node 기본 모듈인 path</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span> <span class="err">#</span> <span class="nx">express</span> <span class="nx">생성</span> <span class="nx">함수</span> <span class="nx">호출</span>

<span class="c1">// all environments</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">port</span><span class="dl">'</span><span class="p">,</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">);</span> <span class="c1">// || 연산자는 process.env.PORT 가 NULL 값이라면 3000을, 값이 존재한다면 그값을 그대로 사용하도록 한다.</span>
<span class="c1">// process 는 node 에 기본으로 있는 global object 라서 어디에서나 사용 가능하다.</span>
<span class="c1">//node 를 실행시킬때 PORT=3001 node app.js 실행 해주면 process.env.PORT 값이 3001이 된다.</span>
<span class="c1">// 그렇게 되는 이유는 노드가 알아서 그렇게 하기 때문! app.set 은 port 키값으로 해당 값을 저장하는것이다.</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">views</span><span class="dl">'</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">views</span><span class="dl">'</span><span class="p">));</span> <span class="c1">// views 키 값에 __dirname (현재 Root 디렉토리)/views 경로를 지정</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">view engine</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">jade</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// 기본 view engine 을 jade 로 설정, html 파일을 표현할수 있는 여러 view engine 이 존재한다. ejb jade 등등</span>
<span class="c1">// Express 에서 사용할 미들웨어들 정의</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">favicon</span><span class="p">());</span> <span class="c1">// favicon 미들웨어 ( 웹브라우져 주소창에 보이는 작은 이미지)</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">logger</span><span class="p">(</span><span class="dl">'</span><span class="s1">dev</span><span class="dl">'</span><span class="p">));</span> <span class="c1">// express 에 log level 을 dev 로 설정 ( dev 로 하면 좀더 많은 로그들을 출력함)</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span> <span class="c1">// json 을 알아서 파싱함</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">());</span> <span class="c1">// url 을 인코딩함</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">());</span> <span class="c1">// methodOverride 기능 ( 웹 브라우져에서 PUT PATCH 는 지원하지 않으므로 해당 기능을 지원하기 위해 _method 변수를 사용 - 몰라도 됨)</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">router</span><span class="p">);</span> <span class="c1">// 유저가 정의한 라우팅 사용</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kd">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">public</span><span class="dl">'</span><span class="p">)));</span> <span class="c1">// static file ( 이미지 동영상 css js) 등을 서비스</span>

<span class="c1">// development only</span>
<span class="k">if</span> <span class="p">(</span><span class="dl">'</span><span class="s1">development</span><span class="dl">'</span> <span class="o">==</span> <span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">env</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// 개발 버젼으로 서버가 돌아가고 있다면 (NODE_ENV=development node app.js 로 실행하면! - development 가 기본)</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">());</span>  <span class="c1">// express 의 errorHandler 를 사용한다.</span>
<span class="p">}</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="nx">routes</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span> <span class="c1">// http://127.0.0.1 로 요청이 들어오면 routes.index 함수로 보낸다</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/users</span><span class="dl">'</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">list</span><span class="p">);</span> <span class="c1">// http://127.0.0.1/users 로 요청이 오면 user.list 함수로 보낸다.</span>

<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">port</span><span class="dl">'</span><span class="p">),</span> <span class="kd">function</span><span class="p">(){</span> <span class="c1">// 서버 생성 하고 listen 이벤트 생성</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Express server listening on port </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">port</span><span class="dl">'</span><span class="p">));</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h3 id="미들웨어">미들웨어</h3>
<p>미들웨어란 웹 프레임워크와 나의 프로그램과 사이에 존재하는 프로그램이라고 생각하면된다.
실제 웹 프레임 워크에 있는 모든 기능을 사용하지는 않는다. 모바일용 API 를 만든다면 해당 웹 프레임워크에 쿠키나 MethodOverride 등등 많은 기능을 사용하지 않는다.
해당 기능을 제공하는 미들웨어를 제거해서 좀더 가볍고 빠른 서버를 만드는게 가능하다!
(사용하지 않는 기능이 있으면 불필요하게 특정 상황을 체크한다거나 HTTP 해더에 불필요한 정보를 포함한다거나 한다!)
Express 에서 미들웨어에는 순서가 중요하다!</p>

<p>Node.js 기본 프로젝트를 실행시킨후 웹브라우져로 접속하면 요청이 두번들어오는것을 알수있다.</p>
<blockquote>
  <p>http://127.0.0.1</p>
</blockquote>

<blockquote>
  <p>http://127.0.0.1/favicon // 브라우져가 해당 웹싸이트에 favicon 을 찾기위해 추가적인 요청을 진행한다.</p>
</blockquote>

<p>맨위에 <code class="language-plaintext highlighter-rouge">app.use(express.favicon()); </code> favicon 미들웨어를 사용하면
favicon 요청은 해당 미들웨어에서 처리 되고 아래로 추가적인 요청이 들어가지 않는다.
favicon 을 서비스하기 위해 구지 json urlencoded 미들웨어를 사용할 이유가 없다!</p>

<p>추가적으로 앱 API 서버를 만든다면 구지 favicon methodOverride 기능은 필요하지 않다!
즉 삭제해도 좋다!</p>

<p>미들웨어를 사용하면 추가적인 기능을 추가하거나 필요없는 기능을 쉽게 뺄수있어좋다! 다른 웹 프레임 워크에서 미들웨어 개념이 있지만 Express 만큼 유연하지 못하다! 그래서 Express 가 짱임!</p>

<p>추가적으로 나만의 미들웨어를 사용 해 볼 수 있다.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">My MiddleWare</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>위에 내용울 <code class="language-plaintext highlighter-rouge">app.router</code> 아래에 두면 My middleware 로그가 남지 남지 않는다.
즉 웹브라우져의 요청은 app.route 에서 처리되고 아래로 내려가지 않는다!
만악에 http://127.0.0.1/images/test.png 로 접속한다면 로그는 남게 될것이다. image 파일을 처리하기 위해서는 express.static 미들웨어 까지 내려가야 하기 때문이다!</p>

<h3 id="reference">Reference</h3>
<p><a href="http://firejune.io/express/">Express Doc</a> 한글로 되어있는 Document</p>

  </article>

  <!-- Twitter -->
<span class="post-sharing">
  <a href="https://twitter.com/share" class="twitter-share-button" data-size="large">Tweet</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</span>



<!-- Reddit -->
<span class="post-sharing" style="margin-right: 32px">
  <script type="text/javascript" src="//www.redditstatic.com/button/button1.js"></script>
</span>
<!-- Facebook -->
<span class="post-sharing">
  <div class="fb-share-button" data-href="http://rangken.github.io/blog/2014/express/" data-layout="button" style="width: 70px;"></div>
</span>


  <div>
		

    

    
</div>

  <div class="fb-comments" data-href="http://rangken.github.io/blog/2014/express/" data-numposts="5" data-colorscheme="light" data-width="750"></div>


</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Young.k</li>
          <li><a href="mailto:rangken@gmail.com">rangken@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/rangken" target="_blank">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">rangken</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/rangken87" target="_blank">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">rangken87</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
      <!-- footer desctiption <p class="text"></p> -->
      Powered by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a> & <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>
      </div>
    </div>

  </div>
  <div id="fb-root"></div>
</footer>


  </body>

</html>
